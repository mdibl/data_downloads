#!/bin/sh

# Organization: MDIBL
# Author: Lucie Hutchins
# Date: August 2017
#
comment="Gets OrthoDB's Current Release Readme file"
#SRC_CONFIG_BASE=`realpath $WORKING_DIR`
source $SRC_CONFIG_BASE/orthodb.cfg

## setting to fetch the current release number
#  and the associated readme file
REMOTE_FILES="README.txt"

RELEASE_TOKEN_LEFT="<td><a href=\/"
RELEASE_TOKEN=`curl -s "$DATA_DOWNLOADS_PAGE" | grep $REMOTE_FILES |sed -e "s/$RELEASE_TOKEN_LEFT//" | sed -e 's/^[[:space:]]*//'`
REMOTE_DOWNLOAD_BASE=`echo $RELEASE_TOKEN | cut -d ' ' -f1 |  sed -e 's/\/README.txt//'`
RELEASE_NUMBER=`echo $REMOTE_DOWNLOAD_BASE | sed -e 's/\/download//' | sed -e 's/[[:space:]]*$//'`

# set path of files on remote server
REMOTE_SITE=${HTTP_SITE}
#url to remote site
REMOTE_SITE_URL=http://$REMOTE_SITE
REMOTE_DIR=/$RELEASE_NUMBER/download

LOCAL_DIR=${SHORT_NAME}


#
# wget options
remote_user=anonymous
remote_password=biocore@mdibl.org

WGET_OPTIONS=" --user=$remote_user --password=$remote_password --no-parent -S -t 10 -nd -m"


#******** Optional *************
# create a symbolic link for this source
#
create_src_symlink=false
# Remove any files in local directory that are not in remote directory
do_deletes=false
recursive=false


#
# wget
# -S = print the headers sent by HTTP servers and responses sent by FTP servers.
# -o = full path to log file
# -O = full path to output file
# -t = number of retries
# -r = reverse
# -k 7 = sort by the 7th column
# -nd = don't create directories
# -m = Turn on options suitable for mirroring. This option turns on recursion 
#    and time-stamping, sets infinite recursion depth and keeps FTP 
#    directory listings. It is currently equivalent to .-r -N -l 
#    inf --no-remove-listing.. 

